<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Backup Wordpress website offsite with Tarsnap | dereference</title>
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/dark.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
<link href="../../assets/css/custom.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://stevendouglas.me/posts/backup-wordpress-website-offsite-with-tarsnap/">
<link rel="icon" href="../../favicon.png" sizes="128x128">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Steven Douglas">
<link rel="prev" href="../freebsd-replace-a-root-disk-from-bsdinstall-connected-to-a-raid-controller/" title="FreeBSD replace a root disk from bsdinstall connected to a RAID controller" type="text/html">
<link rel="next" href="../building-packages-with-poudriere/" title="building packages with poudriere" type="text/html">
<meta property="og:site_name" content="dereference">
<meta property="og:title" content="Backup Wordpress website offsite with Tarsnap">
<meta property="og:url" content="https://stevendouglas.me/posts/backup-wordpress-website-offsite-with-tarsnap/">
<meta property="og:description" content="I use tarsnap because it sticks to the unix philosophy...it does one thing (backups) very well. Encryption is done on the client before the backup ever leaves, and it is as easy as using tar.
Make sur">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-03-27T22:55:24-07:00">
</head>
<body class="hack dark">

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="../../" title="dereference" rel="home">

        <span id="blog-title">dereference</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../archive.html">Posts by date</a></li>
                <li><a href="../../resume-latest-public.pdf">Resume</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="https://github.com/elstevi/"><img class="socialmedia" width="25px" src="../../github.png"></a></li>
                <li><a href="https://www.linkedin.com/in/steven-douglas-b301a4137"><img class="socialmedia" width="30px" src="../../linkedin.png"></a></li>
                <li><a href="https://twitter.com/elstevi"><img class="socialmedia" width="25px" src="../../twitter.png"></a></li>

    

    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Backup Wordpress website offsite with Tarsnap</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Steven Douglas
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2018-03-27T22:55:24-07:00" itemprop="datePublished" title="2018-03-27 22:55">2018-03-27 22:55</time></a>
            </p>
            
        <p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I use <a href="https://www.tarsnap.com/">tarsnap</a> because it sticks to the unix philosophy...it does one thing (backups) very well. Encryption is done on the client before the backup ever leaves, and it is as easy as using tar.</p>
<h3>Make sure you are signed up with tarsnap</h3>
<p>If you haven't already, <a href=".">go get an account at tarsnap</a>. You will need one to complete this tutorial. I put about $5 in my account, and have never refilled it.</p>
<!-- TEASER_END -->
<h3>Install tarsnap</h3>
<p>This can be done with ports or packages, I am going to pick packages because lazy.</p>
<div class="code"><pre class="code literal-block"><span class="n">root</span><span class="err">@</span><span class="n">stevendouglas</span><span class="p">:</span><span class="o">~</span><span class="w"> </span><span class="c1"># pkg install -y tarsnap</span>
<span class="n">Updating</span><span class="w"> </span><span class="n">FreeBSD</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="n">catalogue</span><span class="o">...</span>
<span class="n">FreeBSD</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">date</span><span class="o">.</span>
<span class="n">All</span><span class="w"> </span><span class="n">repositories</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">date</span><span class="o">.</span>
<span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">package</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">checked</span><span class="p">):</span>

<span class="n">New</span><span class="w"> </span><span class="n">packages</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">INSTALLED</span><span class="p">:</span>
<span class="w">        </span><span class="n">tarsnap</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="o">.</span><span class="mi">37</span><span class="n">_1</span>

<span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">packages</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">installed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>

<span class="mi">224</span><span class="w"> </span><span class="n">KiB</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">downloaded</span><span class="o">.</span>
<span class="p">[</span><span class="n">stevendouglas</span><span class="o">.</span><span class="n">me</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">Fetching</span><span class="w"> </span><span class="n">tarsnap</span><span class="o">-</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">37</span><span class="n">_1</span><span class="o">.</span><span class="n">txz</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w">  </span><span class="mi">224</span><span class="w"> </span><span class="n">KiB</span><span class="w"> </span><span class="mf">229.2</span><span class="n">kB</span><span class="o">/</span><span class="n">s</span><span class="w">    </span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>
<span class="n">Checking</span><span class="w"> </span><span class="n">integrity</span><span class="o">...</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">conflicting</span><span class="p">)</span>
<span class="p">[</span><span class="n">stevendouglas</span><span class="o">.</span><span class="n">me</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">Installing</span><span class="w"> </span><span class="n">tarsnap</span><span class="o">-</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">37</span><span class="n">_1</span><span class="o">...</span>
<span class="p">[</span><span class="n">stevendouglas</span><span class="o">.</span><span class="n">me</span><span class="p">]</span><span class="w"> </span><span class="n">Extracting</span><span class="w"> </span><span class="n">tarsnap</span><span class="o">-</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">37</span><span class="n">_1</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span>
<span class="n">Message</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">tarsnap</span><span class="o">-</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">37</span><span class="n">_1</span><span class="p">:</span>
<span class="o">================================================================================</span>

<span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">tarsnap</span><span class="w"> </span><span class="n">before</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">account</span>
<span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tarsnap</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">deposit</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">you</span>
<span class="n">can</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">tarsnap</span><span class="p">;</span><span class="w"> </span><span class="n">see</span>
<span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">tarsnap</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gettingstarted</span><span class="o">.</span><span class="n">html</span>
<span class="k">for</span><span class="w"> </span><span class="n">details</span><span class="o">.</span>

<span class="n">Once</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">tarsnap</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">using</span>
<span class="n">the</span><span class="w"> </span><span class="n">tarsnap</span><span class="o">-</span><span class="n">keygen</span><span class="w"> </span><span class="n">utility</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">storing</span><span class="w"> </span><span class="n">archives</span><span class="p">;</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">key</span>
<span class="n">file</span><span class="w"> </span><span class="n">MUST</span><span class="w"> </span><span class="n">BE</span><span class="w"> </span><span class="n">KEPT</span><span class="w"> </span><span class="n">IN</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">SAFE</span><span class="w"> </span><span class="n">LOCATION</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span>
<span class="n">your</span><span class="w"> </span><span class="n">backups</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">it</span><span class="o">.</span>

<span class="o">================================================================================</span>
</pre></div>

<h3>Configure the host for tarsnap use</h3>
<p>Take this example command from <a href="https://www.tarsnap.com/gettingstarted.html">tarsnap's legit documentation</a>:</p>
<div class="code"><pre class="code literal-block"><span class="n">sudo</span><span class="w"> </span><span class="n">tarsnap</span><span class="o">-</span><span class="n">keygen</span><span class="w"> </span><span class="c1">--keyfile /root/tarsnap.key --user me@example.com --machine mybox</span>
</pre></div>

<p>and retrofit it to suit your needs. The <code>--user</code> flag will need to match your tarsnap account username. The machine can really be whatever you want, I generally use the <code>hostname</code>.</p>
<p>This will register the machine it is run on with tarsnap. It will ask for your password.</p>
<p>Take the <code>/root/tarsnap.key</code> and save it somewhere. Without this key, you will be unable to restore from your backups! Also, anyone who acquires this key will be able to restore your backups!</p>
<p>For tarsnap keys, I generally keep two copies. I have one that gets put into my password manager, and one gets put in a safe deposit box. Seriously. They are cheap and a relatively secure place to keep things. I suggest getting a safe deposit box that is relatively accessible and geographically diverse from your home.</p>
<h3>Write a backup script</h3>
<p>This is the backup script I wrote for backing up this wordpress site:</p>
<div class="code"><pre class="code literal-block"><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"Backup starting - `date`"</span>
<span class="nv">BACKUPS_TO_KEEP</span><span class="o">=</span><span class="m">60</span>
<span class="nv">BACKUP_NAME</span><span class="o">=</span><span class="s1">'stevendouglas.me-backup'</span>
<span class="nv">STAGING_DIR</span><span class="o">=</span><span class="s2">"/tmp/backups/</span><span class="si">${</span><span class="nv">BACKUP_NAME</span><span class="si">}</span><span class="s2">"</span>
<span class="nv">WORDPRESS_DIR</span><span class="o">=</span><span class="s1">'/usr/local/www/wordpress'</span>
<span class="nv">WP_CONFIG</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">WORDPRESS_DIR</span><span class="si">}</span><span class="s2">/wp-config.php"</span>

<span class="nv">MYSQL_HOST</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span>-r<span class="w"> </span>-i<span class="w"> </span>DB_HOST<span class="w"> </span><span class="si">${</span><span class="nv">WP_CONFIG</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="se">\'</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="nv">MYSQL_NAME</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span>-r<span class="w"> </span>-i<span class="w"> </span>DB_NAME<span class="w"> </span><span class="si">${</span><span class="nv">WP_CONFIG</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="se">\'</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="nv">MYSQL_PASS</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span>-r<span class="w"> </span>-i<span class="w"> </span>DB_PASSWORD<span class="w"> </span><span class="si">${</span><span class="nv">WP_CONFIG</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="se">\'</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="nv">MYSQL_USER</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span>-r<span class="w"> </span>-i<span class="w"> </span>DB_USER<span class="w"> </span><span class="si">${</span><span class="nv">WP_CONFIG</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="se">\'</span><span class="w"> </span>-f2<span class="sb">`</span>

mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">STAGING_DIR</span><span class="si">}</span>
<span class="nb">printf</span><span class="w"> </span><span class="s2">"Dumping database..."</span>
mysqldump<span class="w"> </span>--single-transaction<span class="w"> </span>-u<span class="w"> </span><span class="si">${</span><span class="nv">MYSQL_USER</span><span class="si">}</span><span class="w"> </span>-p<span class="si">${</span><span class="nv">MYSQL_PASS</span><span class="si">}</span><span class="w"> </span>-h<span class="w"> </span><span class="si">${</span><span class="nv">MYSQL_HOST</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">MYSQL_NAME</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">STAGING_DIR</span><span class="si">}</span>/db.sql
<span class="nb">echo</span><span class="w"> </span><span class="s2">"done"</span>

<span class="nb">printf</span><span class="w"> </span><span class="s2">"Copying wordpress files..."</span>
cp<span class="w"> </span>-R<span class="w"> </span><span class="si">${</span><span class="nv">WORDPRESS_DIR</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">STAGING_DIR</span><span class="si">}</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"done"</span>

<span class="nb">printf</span><span class="w"> </span><span class="s2">"Running tarsnap..."</span>
tarsnap<span class="w"> </span>-c<span class="w"> </span>-f<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">BACKUP_NAME</span><span class="si">}</span><span class="s2">-</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d_%H-%M-%S<span class="k">)</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">STAGING_DIR</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>/dev/null
<span class="nb">printf</span><span class="w"> </span><span class="s2">"</span><span class="nv">$?</span><span class="s2">."</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"done"</span>
rm<span class="w"> </span>-rf<span class="w"> </span><span class="si">${</span><span class="nv">STAGING_DIR</span><span class="si">}</span>

<span class="nv">CURRENT_BACKUPS</span><span class="o">=</span><span class="sb">`</span>tarsnap<span class="w"> </span>--list-archives<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">BACKUP_NAME</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="sb">`</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"We want to have </span><span class="si">${</span><span class="nv">BACKUPS_TO_KEEP</span><span class="si">}</span><span class="s2"> backups, and have </span><span class="si">${</span><span class="nv">CURRENT_BACKUPS</span><span class="si">}</span><span class="s2">."</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">CURRENT_BACKUPS</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span>-gt<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">BACKUPS_TO_KEEP</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"trimming old backups"</span>
<span class="w">        </span><span class="nv">BACKUPS_TO_TRIM</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">CURRENT_BACKUPS</span><span class="si">}</span>-<span class="si">${</span><span class="nv">BACKUPS_TO_KEEP</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="sb">`</span>
<span class="w">        </span><span class="nv">DELETE_BACKUPS</span><span class="o">=</span><span class="sb">`</span>tarsnap<span class="w"> </span>--list-archives<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">BACKUP_NAME</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-r<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">BACKUPS_TO_TRIM</span><span class="si">}</span><span class="sb">`</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span>BACKUP<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$DELETE_BACKUPS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">                </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"Deleting </span><span class="si">${</span><span class="nv">BACKUP</span><span class="si">}</span><span class="s2">..."</span>
<span class="w">                </span>tarsnap<span class="w"> </span>-d<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">BACKUP</span><span class="si">}</span><span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>/dev/null
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"DONE"</span>
<span class="w">        </span><span class="k">done</span>
<span class="k">fi</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"Backup finishing - `date`"</span>
</pre></div>

<h3>Running at an interval</h3>
<p>This line in cron should do it:</p>
<div class="code"><pre class="code literal-block"><span class="mf">0</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">backup</span><span class="mf">.</span><span class="n">sh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">backup</span><span class="w"> </span><span class="mf">2</span><span class="o">&gt;</span><span class="err">&amp;</span><span class="mf">1</span>
</pre></div>

<p>You are now backing up daily at 2AM.</p>
<h3>Restoring</h3>
<p>First find the backup you want to restore:</p>
<div class="code"><pre class="code literal-block"><span class="n">root</span><span class="nv">@stevendouglas</span><span class="err">:</span><span class="o">~</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">tarsnap</span><span class="w"> </span><span class="c1">--list-archives | sort</span>
<span class="n">stevendouglas</span><span class="p">.</span><span class="n">me</span><span class="o">-</span><span class="k">backup</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">25</span><span class="n">_19</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span>
<span class="n">stevendouglas</span><span class="p">.</span><span class="n">me</span><span class="o">-</span><span class="k">backup</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">25</span><span class="n">_19</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">35</span>
<span class="n">stevendouglas</span><span class="p">.</span><span class="n">me</span><span class="o">-</span><span class="k">backup</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">25</span><span class="n">_19</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">08</span>
</pre></div>

<p>And use this command to restore:</p>
<div class="code"><pre class="code literal-block">tarsnap -x -f stevendouglas.me-backup-2017-06-25_19-16-08
</pre></div>

<p>And our files are restored:</p>
<div class="code"><pre class="code literal-block"><span class="n">root</span><span class="nv">@stevendouglas</span><span class="err">:</span><span class="o">~</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">lh</span><span class="w"> </span><span class="n">tmp</span><span class="o">/</span><span class="n">backups</span><span class="o">/</span><span class="n">stevendouglas</span><span class="p">.</span><span class="n">me</span><span class="o">-</span><span class="k">backup</span><span class="o">/</span><span class="w">                                                                                                                                    </span>
<span class="n">total</span><span class="w"> </span><span class="mi">234</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r--  1 root  wheel   678K Jun 25 19:16 db.sql</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="n">wheel</span><span class="w">    </span><span class="mi">23</span><span class="n">B</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">19</span><span class="err">:</span><span class="mi">16</span><span class="w"> </span><span class="n">wordpress</span>
</pre></div>

<h3>Conclusion</h3>
<p>You did backup your key...right? Tarsnap is a wonderfully simple service that does exactly what it says on the box. </p>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../freebsd-replace-a-root-disk-from-bsdinstall-connected-to-a-raid-controller/" rel="prev" title="FreeBSD replace a root disk from bsdinstall connected to a RAID controller">Previous post</a>
            </li>
            <li class="next">
                <a href="../building-packages-with-poudriere/" rel="next" title="building packages with poudriere">Next post</a>
            </li>
        </ul></nav></aside></article></main><footer id="footer"><p>©2025 Steven Douglas</p>
            
        </footer>
</div>
    
    

    
    
    
</body>
</html>
